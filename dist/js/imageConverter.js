!function(t,e){function a(t,a){if(!(1>a&&a>0))throw"scale must be a positive number <1 ";var i=a*a,r=t.width,h=t.height,n=Math.ceil(r*a),d=Math.ceil(h*a),o=0,c=0,g=0,f=0,s=0,w=0,v=0,l=0,p=0,u=0,m=0,_=0,x=0,y=0,C=0,I=!1,M=!1,D=t.getContext("2d").getImageData(0,0,r,h).data,O=new Float32Array(4*r*h),b=0,E=0,A=0,H=0;for(c=0;h>c;c++)for(s=c*a,p=0|s,w=4*p*n,M=p!=(0|s+a),M&&(y=p+1-s,C=s+a-p-1),o=0;r>o;o++,g+=4)f=o*a,l=0|f,v=w+4*l,I=l!=(0|f+a),I&&(_=l+1-f,x=f+a-l-1),b=D[g],E=D[g+1],A=D[g+2],H=D[g+3],I||M?I&&!M?(u=_*a,O[v]+=b*u,O[v+1]+=E*u,O[v+2]+=A*u,O[v+3]+=H*u,m=x*a,O[v+4]+=b*m,O[v+5]+=E*m,O[v+6]+=A*m,O[v+7]+=H*m):M&&!I?(u=y*a,O[v]+=b*u,O[v+1]+=E*u,O[v+2]+=A*u,O[v+3]+=H*u,m=C*a,O[v+4*n]+=b*m,O[v+4*n+1]+=E*m,O[v+4*n+2]+=A*m,O[v+4*n+3]+=H*m):(u=_*y,O[v]+=b*u,O[v+1]+=E*u,O[v+2]+=A*u,O[v+3]+=H*u,m=x*y,O[v+4]+=b*m,O[v+5]+=E*m,O[v+6]+=A*m,O[v+7]+=H*m,m=_*C,O[v+4*n]+=b*m,O[v+4*n+1]+=E*m,O[v+4*n+2]+=A*m,O[v+4*n+3]+=H*m,m=x*C,O[v+4*n+4]+=b*m,O[v+4*n+5]+=E*m,O[v+4*n+6]+=A*m,O[v+4*n+7]+=H*m):(O[v]+=b*i,O[v+1]+=E*i,O[v+2]+=A*i,O[v+3]+=H*i);var W=e.createElement("canvas");W.width=n,W.height=d;var z=W.getContext("2d"),L=z.getImageData(0,0,n,d),R=L.data,U=0;for(g=0,v=0;n*d>U;g+=4,v+=4,U++)R[v]=Math.ceil(O[g]),R[v+1]=Math.ceil(O[g+1]),R[v+2]=Math.ceil(O[g+2]),R[v+3]=Math.ceil(O[g+3]);return z.putImageData(L,0,0),W}var i=function(t,a){var i=e.createElement("canvas");return i.width=t,i.height=a,i},r=function(t,e,a){var r=i(e,a);return r.getContext("2d").drawImage(t,0,0,e,a),r},h=function(t,a){var i=e.createElement("img"),r=e.createElement("div");r.style.cssText="overflow:hidden;width:0px;height:0px;",i.onload=function(){a({width:i.width,height:i.height}),e.body.removeChild(r)},i.src=t.src,r.appendChild(i),e.body.appendChild(r)},n=function(t,e,h,n,d,o){var c,g,f;if(rateW=e.width/h,rateH=e.height/n,rateW<rateH?rate=rateW:rate=rateH,rate?(c=parseInt(e.width/rate),g=parseInt(e.height/rate)):(c=e.width,g=e.height),rate>1){var s=i(e.width,e.height);s.getContext("2d").drawImage(t,0,0,e.width,e.height),f=a(s,1/rate)}else f=r(t,c,g);diff_w=c-h,diff_h=g-n,diff_w?start_x=diff_w/2:start_x=0,diff_h?start_y=diff_h/2:start_y=0;var w=i(h,n);w.getContext("2d").drawImage(f,start_x,start_y,h,n,0,0,h,n),o&&o.type?(o.encoderOptions=o.encoderOptions?o.encoderOptions:1,d(w.toDataURL(o.type,o.encoderOptions))):d(w.toDataURL())};t.imageConverter={resizeAndOptimize:function(t,e,a,i,d){d||"function"!=typeof i||(d=i);var o=/(iphone|ipad)/i.test(navigator.userAgent);h(t,function(h){var c=h.width>h.height?h.width:h.height,g=1924;if(o&&c>g){var f=h.width/g,s=h.height/g,w=f>s?f:s,v=r(t,w*e,w*a);n(v,h,e,a,d,i)}else n(t,h,e,a,d,i)})}}}(window,document);